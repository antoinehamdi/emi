pipeline {
	agent {
		label "slave1"
    }
    options {
		timestamps()
        parallelsAlwaysFailFast()
    }
    stages {
		stage('checkout') {
			steps {
				git branch: 'master',
    			    credentialsId: '6300dc75-8c6c-4d43-b6ae-013ec917776e',
                    url: 'https://github.com/Ninjasimov/Projet-CD-CI.git'
			}
		}
		stage('testing') {
			   parallel {
            	stage('junit') {
            		tools {
		                maven "maven3"
	                } 
                    steps {
                        sh "mvn   -s settings.xml  test -Dmaven.test.failure.ignore=true"
                        step([$class: 'XUnitBuilder',
    thresholds: [
        [$class: 'SkippedThreshold', failureThreshold: '0'],
        // Allow for a significant number of failures
        // Keeping this threshold so that overwhelming failures are guaranteed
        //     to still fail the build
        [$class: 'FailedThreshold', failureThreshold: '1', thresholdmode: 'percent']],
    tools: [[$class: 'JUnitType', pattern: 'target/surefire-reports/**.xml']]]) 
                    }
                }
                stage('pmd') {
                    steps {
                        sh "mvn  -s settings.xml  pmd:pmd"
                    }
                }
              
            }
		}
		stage('deploy'){
		    steps{
		        sh "mvn -s settings.xml deploy -Dmaven.test.failure.ignore=true"
		    }
		}
    }
}